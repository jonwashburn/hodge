# Stage 1 (A1): Manifold Test-Form Spaces ‚Äî Strategy

This note complements `docs/notes/STAGE1_TEST_FORMS_MATHLIB_SURVEY.md` by outlining how to go from
Mathlib‚Äôs **Euclidean** LF test-function space `ùìì(Œ©, F)` to a **manifold** test-form space suitable
for currents.

## 0. Constraints from this repo

All ‚Äúprojective complex manifolds‚Äù in the proof track satisfy:

- `ProjectiveComplexManifold n X` extends `CompactSpace X`
- `X` is modeled on `EuclideanSpace ‚ÑÇ (Fin n)` with `IsManifold (ùìí_complex n) ‚ä§ X`

So in the proof-track setting, `X` is **compact**. This is good: on a compact manifold, the ‚Äútest
form space‚Äù is naturally **Fr√©chet** (not LF), because ‚Äúcompactly supported‚Äù is automatic.

## 1. Euclidean side: already in Mathlib

Mathlib provides the LF-space of compactly supported smooth functions on open subsets of finite-dim
normed spaces:

- `Mathlib.Analysis.Distribution.ContDiffMapSupportedIn`
- `Mathlib.Analysis.Distribution.TestFunction`

We already specialized this to *Euclidean test forms* in:

- `Hodge/Analytic/DistributionTestForms.lean`

where:

- `EuclidTestForm n k Œ© := ùìì(Œ©, FiberAlt n k)`
- `EuclidCurrent n k Œ© := EuclidTestForm n k Œ© ‚ÜíL[‚Ñù] ‚Ñù`

## 2. Manifold goal (compact case): a Fr√©chet space of smooth forms

For compact `X`, the planned end-state is:

- `TestFormSpace n X k` is a **locally convex** topological vector space whose underlying set is
  `SmoothForm n X k`.
- The topology is generated by a countable family of seminorms measuring derivatives up to order `m`
  in local charts (plus partitions of unity to globalize).

Key Mathlib ingredient for ‚Äútopology from seminorms‚Äù:

- `Mathlib.Analysis.LocallyConvex.WithSeminorms`

## 3. Two viable construction strategies

### Strategy A (finite atlas, compactness): embed into a finite product of Euclidean `C^‚àû` spaces

1. Choose a **finite** chart cover of compact `X`:
   - use `CompactSpace` + `IsManifold` to extract an open cover by chart domains
   - choose a finite subcover (standard compactness lemma)
2. For each chart domain `U·µ¢`, represent a smooth form `œâ` by its coordinate expression on `U·µ¢`
   (a smooth map `E ‚Üí FiberAlt n k` on an open subset of `Euclid n`)
3. Put the topology on `SmoothForm` as the **initial topology** induced by the map
   `œâ ‚Ü¶ (œâ|_{U·µ¢})·µ¢` into the finite product of Euclidean `C^‚àû`-type spaces.

Pros:
- avoids LF inductive limits entirely in the compact setting
- finite product is easy to manage

Cons:
- requires careful chart-change compatibility bookkeeping
- needs a clean ‚Äúcoordinate expression of forms‚Äù API (currently our `SmoothForm` is abstracted)

### Strategy B (seminorm family): directly define Fr√©chet topology via `WithSeminorms`

1. Define a seminorm family indexed by `(i, m, Œ±)` where:
   - `i` is a chart index from a finite atlas,
   - `m` is derivative order,
   - `Œ±` ranges over finitely many multiindices / basis directions.
2. Each seminorm is the sup-norm of the corresponding coordinate partial derivative on the chart image.
3. Use `WithSeminorms` to build the locally convex topology.

Pros:
- matches the classical definition of `C^‚àû` topology
- aligns with how Mathlib defines topologies for `ContDiffMapSupportedIn`

Cons:
- requires implementing the ‚Äúderivatives of coordinate expressions‚Äù story

## 4. Minimal ‚ÄúStage 1 deliverable‚Äù for the Hodge pipeline

To start replacing bespoke `Current` structures, we need:

1. A type `TestFormSpace n X k` (underlying set `SmoothForm n X k`)
2. A `TopologicalSpace` + `LocallyConvexSpace` structure on it
3. Continuous linear maps:
   - `d : TestFormSpace n X k ‚ÜíL[‚Ñù] TestFormSpace n X (k+1)`
   - `wedge : TestFormSpace n X k ‚ÜíL[‚Ñù] (TestFormSpace n X l ‚ÜíL[‚Ñù] TestFormSpace n X (k+l))`

Then define:

- `Current n X k := TestFormSpace n X k ‚ÜíL[‚Ñù] ‚Ñù`

and boundary:

- `‚àÇT(œâ) := T(dœâ)` (precomposition with `d`).

## 5. Recommended next Lean files (non-proof-track first)

Create these as *new* modules (not imported by proof track yet):

- `Hodge/Analytic/Stage1/ManifoldTestForms.lean`
  - defines `TestFormSpace` (compact manifold version) + topology (Strategy A or B)
- `Hodge/Analytic/Stage1/ManifoldCurrents.lean`
  - defines `Current` as `ContinuousLinearMap` out of `TestFormSpace`
  - defines `boundary` by precomposition with `d`
- `Hodge/Analytic/Stage1/ContinuityOps.lean`
  - continuity of `d`, wedge, pullback

Once these exist, we can start migrating the current proof track away from bespoke boundedness fields.

